{% extends 'base.html' %}

{% block content %}
<h1 style="color: #00ffff; text-align: center; margin-bottom: 2rem; text-shadow: 0 0 15px #00ffff;">
    {% if user.is_authenticated and user.city and not show_all_cities %}
        –¢—É—Å–æ–≤–∫–∏ –≤ {{ user.city.name }}
    {% else %}
        JDM –¢—É—Å–æ–≤–∫–∏
    {% endif %}
</h1>

{% if user.is_authenticated and user.city %}
<div style="text-align: center; margin-bottom: 2rem;">
    {% if show_all_cities %}
        <a href="{% url 'toggle_city_filter' %}?show_all=false" class="btn-primary" style="width: auto; padding: 10px 20px; display: inline-flex; align-items: center; gap: 0.5rem;">
            –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ {{ user.city.name }}
        </a>
    {% else %}
        <a href="{% url 'toggle_city_filter' %}?show_all=true" class="btn-primary" style="width: auto; padding: 10px 20px; display: inline-flex; align-items: center; gap: 0.5rem; background: #333; color: #00ffff;">
            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –≥–æ—Ä–æ–¥–∞
        </a>
    {% endif %}
</div>
{% endif %}

<div class="section-title">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Ç—É—Å–æ–≤–∫–∏</div>
{% if upcoming_meetups %}
    <div class="card-grid">
        {% for meetup in upcoming_meetups %}
        <a href="{% url 'meetup_detail' meetup.pk %}" style="text-decoration: none;">
            <div class="card">
                <div class="meetup-type">{{ meetup.get_meetup_type_display }}</div>
                <h3 class="card-title">{{ meetup.title }}</h3>
                <p><strong>üìç –ì–æ—Ä–æ–¥:</strong> 
                    {% if meetup.city == user.city %}
                        {{ meetup.city.name }}
                    {% else %}
                        {{ meetup.city.name }}
                    {% endif %}
                </p>
                <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ meetup.location }}</p>
                <p><strong>–ö–æ–≥–¥–∞:</strong> {{ meetup.date_time|date:"d.m.Y H:i" }}</p>
                <p><strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä:</strong> {{ meetup.organizer.nickname }}</p>
                {% if meetup.image %}
                <img src="{{ meetup.image.url }}" alt="{{ meetup.title }}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-top: 1rem;">
                {% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
{% else %}
    <p class="text-muted" style="text-align: center; padding: 2rem;">
        {% if user.is_authenticated and user.city and not show_all_cities %}
            –í –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—É—Å–æ–≤–æ–∫. 
            <a href="{% url 'toggle_city_filter' %}?show_all=true" style="color: #00ffff;">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≥–æ—Ä–æ–¥–∞</a>
        {% else %}
            –ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—É—Å–æ–≤–æ–∫.
        {% endif %}
    </p>
{% endif %}

<div class="section-title">–ü—Ä–æ—à–µ–¥—à–∏–µ —Ç—É—Å–æ–≤–∫–∏</div>
{% if past_meetups %}
    <div class="card-grid">
        {% for meetup in past_meetups %}
        <a href="{% url 'meetup_detail' meetup.pk %}" style="text-decoration: none;">
            <div class="card">
                <div class="meetup-type">{{ meetup.get_meetup_type_display }}</div>
                <h3 class="card-title">{{ meetup.title }}</h3>
                <p><strong>–ì–æ—Ä–æ–¥:</strong> {{ meetup.city.name }}</p>
                <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ meetup.location }}</p>
                <p><strong>–ö–æ–≥–¥–∞:</strong> {{ meetup.date_time|date:"d.m.Y H:i" }}</p>
                <p class="text-muted">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
            </div>
        </a>
        {% endfor %}
    </div>
{% else %}
    <p class="text-muted" style="text-align: center; padding: 2rem;">
        {% if user.is_authenticated and user.city and not show_all_cities %}
            –í –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—à–µ–¥—à–∏—Ö —Ç—É—Å–æ–≤–æ–∫.
        {% else %}
            –ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ—à–µ–¥—à–∏—Ö —Ç—É—Å–æ–≤–æ–∫.
        {% endif %}
    </p>
{% endif %}
{% endblock %}